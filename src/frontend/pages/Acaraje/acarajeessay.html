<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acarajé Essay</title>
    <!-- Use inline CSS for iframe content -->
    <style>
        :root {
            --primary-brown: #6b4e3d;
            --text-color: #333;
        }
        body {
            font-family: "Inter", sans-serif;
            color: var(--text-color);
            line-height: 1.75;
            padding: 2rem;
        }
        .essay-text {
            margin: 0; 
        }
        .essay-text p {
            margin-bottom: 1rem;
            text-indent: 1.5rem; /* Standard essay paragraph indent */
            text-align: justify;
        }
    </style>
</head>
<body>
    <div id="essay-content" class="essay-text">
        <p>Loading essay...</p>
    </div>

    <script>
        const TARGET_CONTENT_NAME = 'Acarajé'; 
        const API_BASE_URL = 'http://localhost:5000';
        const contentContainer = document.getElementById('essay-content');

        function renderEssayContent(essayText) {
            // Split by double newline to detect paragraphs
            const paragraphs = essayText.split(/\n\n+/).filter(p => p.trim() !== '');
            let html = '';

            paragraphs.forEach(p => {
                // Join lines within a single paragraph section with a space
                html += `<p>${p.split('\n').map(line => line.trim()).join(' ')}</p>`;
            });
            
            contentContainer.innerHTML = html;
        }

        // Fetch ALL essays/recipes from the general endpoint
        fetch(`${API_BASE_URL}/essays`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Server error when fetching essays.');
                }
                return response.json();
            })
            .then(data => {
                // Find the specific item by checking if the name includes the target name (case insensitive)
                const primaryContent = data.find(item => item.name && item.name.toLowerCase().includes(TARGET_CONTENT_NAME.toLowerCase()));
                
                if (primaryContent) {
                    renderEssayContent(primaryContent.essay || '');
                } else {
                    contentContainer.innerHTML = `<p style="color: red;">Error: Could not find content named "${TARGET_CONTENT_NAME}" in the database.</p>`;
                }
            })
            .catch(error => {
                console.error('Error fetching essay:', error);
                contentContainer.innerHTML = '<p style="color: red;">Error loading essay. Please check your network and server logs.</p>';
            });
    </script>
</body>
</html>