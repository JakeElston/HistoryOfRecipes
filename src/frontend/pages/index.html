// index.html Script (Revised)
fetch('http://localhost:5000/essays')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    const container = document.getElementById('essays-container');
    
    // Check if data is an array before iterating
    if (!Array.isArray(data)) {
        console.error('API did not return an array:', data);
        container.innerHTML = '<p>Data format error. Cannot display list.</p>';
        return;
    }

    data.forEach(item => {
      // Get the ID for the link. Note: item._id is an object, so we use ._id.$oid or similar. 
      // Based on your image, the actual ID value is inside the ObjectId wrapper. 
      // Assuming your backend sends it back as a simple string, we use item._id.
      // If it returns as an object like the image, you might need item._id.id or item._id.toString()
      // Let's assume your backend is returning a simple string of the ID:
      const itemId = item._id; 
      
      const div = document.createElement('div');
      div.classList.add('essay-card');
      
      // Create a short excerpt (e.g., first 100 characters)
      const excerpt = item.essay ? item.essay.substring(0, 100) + '...' : 'No description available.';

      div.innerHTML = `
        <h2>${item.name}</h2>
        <p>${excerpt}</p>
        
        <a href="devilsfoodcake.html?id=${itemId}" class="btn btn-primary">Read Essay & Recipe</a>
        <hr>
      `;
      container.appendChild(div);
    });
  })
  .catch(error => {
    console.error('Error fetching essays:', error);
    document.getElementById('essays-container').innerHTML =
      '<p>Failed to load essays: ' + error.message + '</p>';
  });